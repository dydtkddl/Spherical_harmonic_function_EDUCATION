# -*- coding: utf-8 -*-
"""
ë¹„ë“±ë°©(ê²°í•©í˜•) 2D ì–‘ì ì¡°í™”ì§„ë™ì
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ ê¸°ë³¸ Ï‰ëŠ” ì¼ì •
â€¢ ê²°í•©í•­ xy â†’ ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜ kâ‚, kâ‚‚ ìƒì„±
â€¢ Hermite í•´ë¥¼ í†µí•œ ì •ê·œí™”ëœ íŒŒë™í•¨ìˆ˜
â€¢ Plotly 3Dë¡œ |Î¨|Â² ì¸í„°ë™í‹°ë¸Œ ì‹œê°í™”
"""

import streamlit as st
import numpy as np
import sympy as sp
import plotly.graph_objects as go
from matplotlib import font_manager

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âœ… í•œê¸€ + LaTeX í˜¸í™˜ í°íŠ¸ ì„¤ì •
def set_font():
    import matplotlib.pyplot as plt
    plt.rcParams["axes.unicode_minus"] = False
    plt.rcParams["mathtext.fontset"] = "stix"
    plt.rcParams["font.size"] = 12
    available_fonts = [f.name for f in font_manager.fontManager.ttflist]
    if "Malgun Gothic" in available_fonts:
        plt.rcParams["font.family"] = "Malgun Gothic"
    elif "AppleGothic" in available_fonts:
        plt.rcParams["font.family"] = "AppleGothic"
    else:
        plt.rcParams["font.family"] = "DejaVu Sans"
set_font()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜ ê¸°ë°˜ ë¹„ë“±ë°© 2D ì¡°í™”ì§„ë™ì", layout="wide")
st.title("ğŸ“ ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜ë¡œ ë³¸ ë¹„ì •ìƒ 2D ì–‘ì ì¡°í™”ì§„ë™ì (Anisotropic 2D QHO)")
st.caption("ê²°í•©í•­ xyë¡œë¶€í„° ìœ ë„ëœ ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜(kâ‚,kâ‚‚) ê¸°ë°˜ ì •ê·œí™” ë° |Î¨|Â² Plotly ì‹œê°í™”")

st.divider()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("1ï¸âƒ£ í•´ë°€í† ë‹ˆì–¸ â€” ê²°í•©í•­ì„ í¬í•¨í•œ 2D ì¡°í™”ì§„ë™ì")

st.markdown(r"""
$$
H = -\frac{\hbar^2}{2m}\left(
\frac{\partial^2}{\partial x^2} + 
\frac{\partial^2}{\partial y^2}
\right)
+ \gamma m\omega^2(x^2 + y^2 + xy)
$$

- ê¸°ë³¸ ì§„ë™ìˆ˜ **Ï‰ëŠ” ì¼ì •**
- ê²°í•©í•­ \(xy\)ë¡œ ì¸í•´ ì¶•ì´ ì„œë¡œ ì˜í–¥ì„ ì£¼ë©° ë¹„ë“±ë°©ì„± ë°œìƒ  
- ì´ë¥¼ í•´ì†Œí•˜ê¸° ìœ„í•´ ì¢Œí‘œë³€í™˜ìœ¼ë¡œ êµì°¨í•­ì„ ì œê±°í•œë‹¤.
""")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("2ï¸âƒ£ ë³€ìˆ˜ë³€í™˜ ë° ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜ ë„ì¶œ")

st.markdown(r"""
ë¨¼ì € ì¢Œí‘œë¥¼ ì„ í˜•ê²°í•© í˜•íƒœë¡œ ë³€í™˜í•œë‹¤:
$$
x + y = X,\quad x - y = Y
$$

ê²°í•©í•­ í¬í•¨ í•­ì„ ë‹¤ì‹œ ì“°ë©´:
$$
x^2 + y^2 + xy = C_1(X)^2 + C_2(Y)^2
$$

ì´ë¥¼ ë§Œì¡±ì‹œí‚¤ëŠ” \(C_1, C_2\)ëŠ”
$$
C_1 + C_2 = 1,\quad C_1 - C_2 = \frac{1}{2}
\Rightarrow C_1 = \frac{3}{4},\; C_2 = \frac{1}{4}
$$

ê²°ê³¼ì ìœ¼ë¡œ êµì°¨í•­ì´ ì‚¬ë¼ì§€ë©° ë‹¤ìŒì˜ í˜•íƒœë¥¼ ì–»ëŠ”ë‹¤:
$$
H = -\frac{\hbar^2}{2m}
\left(\frac{\partial^2}{\partial X^2} + \frac{\partial^2}{\partial Y^2}\right)
+ \frac{1}{2}k_1 X^2 + \frac{1}{2}k_2 Y^2
$$

ì—¬ê¸°ì„œ  
**ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜ëŠ”**
$$
k_1 = 2\gamma m\omega^2 C_1,\quad 
k_2 = 2\gamma m\omega^2 C_2
$$
ì´ê³ ,  
ê·¸ë¡œë¶€í„° **ìœ íš¨ ì§„ë™ìˆ˜**
$$
\omega_1 = \sqrt{\frac{k_1}{m}},\quad
\omega_2 = \sqrt{\frac{k_2}{m}}
$$
ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
""")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ä§, m, Ï‰ = 1.0, 1.0, 1.0
Î³ = st.slider("ê²°í•©ê°•ë„ Î³ (0~2)", 0.1, 2.0, 1.0, 0.1)

C1, C2 = 3/4, 1/4
k1 = 2 * Î³ * m * Ï‰**2 * C1
k2 = 2 * Î³ * m * Ï‰**2 * C2
Ï‰1, Ï‰2 = np.sqrt(k1/m), np.sqrt(k2/m)

st.latex(fr"\omega_1 = {Ï‰1:.3f},\quad \omega_2 = {Ï‰2:.3f}")
st.caption("Î³ë¥¼ ì¡°ì •í•˜ë©´ ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜(kâ‚,kâ‚‚)ê°€ ë°”ë€Œë©°, ì§„ë™ìˆ˜ ë¹„ìœ¨ì´ ë‹¬ë¼ì§")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("3ï¸âƒ£ ì •ê·œí™”ëœ íŒŒë™í•¨ìˆ˜")

st.markdown(r"""
ê° ì¶•ë³„ íŒŒë™í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:
$$
\psi_i(X_i) =
\sqrt[4]{\frac{m\omega_i}{\pi\hbar}}
\frac{1}{\sqrt{2^{n_i} n_i!}}
H_{n_i}\!\left(\sqrt{\frac{m\omega_i}{\hbar}}X_i\right)
e^{-\frac{m\omega_i X_i^2}{2\hbar}}
$$

ë”°ë¼ì„œ ì „ì²´ íŒŒë™í•¨ìˆ˜ëŠ”
$$
\Psi_{n_1,n_2}(X,Y) = \psi_1(X)\psi_2(Y)
$$

ì •ê·œí™” ì¡°ê±´:
$$
\iint |\Psi|^2\,dX\,dY = 1
$$
""")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
col1, col2 = st.columns(2)
with col1:
    n1 = st.slider("nâ‚ (Xì¶• ì–‘ììˆ˜)", 0, 4, 1)
with col2:
    n2 = st.slider("nâ‚‚ (Yì¶• ì–‘ììˆ˜)", 0, 4, 1)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Sympyë¡œ íŒŒë™í•¨ìˆ˜ ì •ì˜
X, Y = sp.symbols("X Y", real=True)
H1 = sp.hermite(n1, sp.sqrt(m*Ï‰1/Ä§)*X)
H2 = sp.hermite(n2, sp.sqrt(m*Ï‰2/Ä§)*Y)
N1 = (m*Ï‰1/(np.pi*Ä§))**0.25 / sp.sqrt(2**n1 * sp.factorial(n1))
N2 = (m*Ï‰2/(np.pi*Ä§))**0.25 / sp.sqrt(2**n2 * sp.factorial(n2))
Ïˆ_expr = N1 * N2 * sp.exp(-m*(Ï‰1*X**2 + Ï‰2*Y**2)/(2*Ä§)) * H1 * H2
Ïˆ_func = sp.lambdify((X, Y), Ïˆ_expr, "numpy")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ê²©ì ìƒì„± ë° í™•ë¥ ë°€ë„ ê³„ì‚°
Xv = np.linspace(-3, 3, 180)
Yv = np.linspace(-3, 3, 180)
Xg, Yg = np.meshgrid(Xv, Yv)
Z = np.abs(Ïˆ_func(Xg, Yg))**2

E = (n1 + 0.5)*Ä§*Ï‰1 + (n2 + 0.5)*Ä§*Ï‰2

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("4ï¸âƒ£ Plotly 3D í™•ë¥ ë°€ë„ ì‹œê°í™”")

fig = go.Figure()

fig.add_trace(go.Surface(
    x=Xg, y=Yg, z=Z,
    colorscale="Viridis",
    opacity=0.95,
    lighting=dict(ambient=0.7, diffuse=0.8, specular=0.4, roughness=0.3),
    contours={"z": {"show": True, "usecolormap": True, "highlightcolor": "limegreen"}},
))

fig.update_layout(
    title=f"|Î¨â‚™â‚â‚™â‚‚(X,Y)|Â² : Î³={Î³:.2f},  E={(E):.3f} Ä§Ï‰,  Ï‰â‚={Ï‰1:.3f}, Ï‰â‚‚={Ï‰2:.3f}",
    scene=dict(
        xaxis_title="X (ë¬´ì°¨ì›)",
        yaxis_title="Y (ë¬´ì°¨ì›)",
        zaxis_title="|Î¨|Â²",
        xaxis=dict(backgroundcolor="rgba(235,235,235,0.4)"),
        yaxis=dict(backgroundcolor="rgba(235,235,235,0.4)"),
        zaxis=dict(backgroundcolor="rgba(250,250,250,0.6)")
    ),
    template="plotly_white",
    margin=dict(l=10, r=10, t=60, b=10),
)

st.plotly_chart(fig, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown(r"""
ğŸ¨ **ë¬¼ë¦¬ì  í•´ì„**
- ê¸°ë³¸ ì§„ë™ìˆ˜ Ï‰ëŠ” ë™ì¼í•˜ì§€ë§Œ, ê²°í•©í•­ \(xy\)ë¡œ ì¸í•´ ìœ íš¨ ìŠ¤í”„ë§ìƒìˆ˜ \(k_1, k_2\)ê°€ ë‹¬ë¼ì§  
- ë”°ë¼ì„œ \( \omega_1 \neq \omega_2 \), ì¦‰ ì¶•ë§ˆë‹¤ ì§„ë™ ì£¼ê¸°ê°€ ë‹¬ë¼ì§  
- ê° \(n_1, n_2\) ëª¨ë“œ ì¡°í•©ì— ë”°ë¼ íŒŒë™í•¨ìˆ˜ì˜ ë…¸ë“œ êµ¬ì¡°ê°€ ë‹¬ë¼ì§€ê³ ,  
  í™•ë¥ ë°€ë„(|Î¨|Â²)ëŠ” X, Yì¶• ë¹„ëŒ€ì¹­ í˜•íƒœë¡œ ë‚˜íƒ€ë‚œë‹¤  
- Î³ â†‘ â†’ ê²°í•©ê°•ë„ â†‘ â†’ ë¹„ë“±ë°©ì„± ì‹¬í™”  

ğŸ’¡ ìŠ¬ë¼ì´ë”ë¡œ Î³, nâ‚, nâ‚‚ë¥¼ ì¡°ì ˆí•˜ë©° ë¹„ë“±ë°© ì¡°í™”ì§„ë™ìì˜ ì—ë„ˆì§€ ì¤€ìœ„ì™€ í™•ë¥ ë¶„í¬ ë³€í™”ë¥¼ ì‹œê°ì ìœ¼ë¡œ íƒêµ¬í•´ë³´ì„¸ìš”.
""")

